<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Video Call</title>
</head>
<body>
<h2>ðŸ“¹ ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ</h2>

<video id="local" autoplay muted playsinline style="width:45%"></video>
<video id="remote" autoplay playsinline style="width:45%"></video>
<br><br>

<button onclick="start(true)">Start Call</button>
<button onclick="start(false)">Join Call</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  databaseURL: "https://video-call-2ecce-default-rtdb.firebaseio.com"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let pc;
const config = {
  iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
};

async function start(isCaller) {
  pc = new RTCPeerConnection(config);

  const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  document.getElementById("local").srcObject = stream;
  stream.getTracks().forEach(t => pc.addTrack(t, stream));

  pc.ontrack = e => document.getElementById("remote").srcObject = e.streams[0];
  pc.onicecandidate = e => e.candidate && db.ref("candidates").push(JSON.stringify(e.candidate));

  if (isCaller) {
    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    db.ref("offer").set(JSON.stringify(offer));
  } else {
    db.ref("offer").on("value", async s => {
      if (s.val()) {
        await pc.setRemoteDescription(JSON.parse(s.val()));
        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);
        db.ref("answer").set(JSON.stringify(answer));
      }
    });
  }

  db.ref("answer").on("value", s => s.val() && pc.setRemoteDescription(JSON.parse(s.val())));
  db.ref("candidates").on("child_added", s => pc.addIceCandidate(JSON.parse(s.val())));
}
</script>
</body>
</html>